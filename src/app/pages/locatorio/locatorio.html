<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<div class="page-container">
  <header class="menu">
    <h1>ProDesk Coworking</h1>
    <nav>
      <a routerLink="/locatorio" routerLinkActive="ativo">Espa√ßos</a>
      <a routerLink="/reserva" routerLinkActive="ativo">Reservas</a>
      <a routerLink="/contato" routerLinkActive="ativo">Contato</a>
      <a routerLink="/cadastrar-espaco" routerLinkActive="ativo">Cadastrar espa√ßo</a>
    </nav>

    <router-outlet></router-outlet>

    <a [routerLink]="'/perfil'" class="user-area" *ngIf="usuarioNome" style="display: flex; align-items: center; text-decoration: none;">
      <span class="user-name" style="margin-right: 8px;">{{ usuarioNome }}</span>
      <img class="user-avatar" [src]="usuarioFoto" alt="Usu√°rio" style="width: 40px; height: 40px; border-radius: 50%;">
    </a>

    <button *ngIf="usuarioNome" (click)="logout()" class="logout-btn" title="Sair">
      <i class="fas fa-right-from-bracket"></i>
    </button>
  </header>

  <div class="busca-filtros">
    <input type="text" placeholder="Buscar por t√≠tulo ou dono" [(ngModel)]="termoBusca" (input)="filtrarEspacos()" />
    <select [(ngModel)]="filtroAvaliacao" (change)="filtrarEspacos()">
      <option value="">Avalia√ß√£o m√≠nima</option>
      <option value="5">‚≠ê 5+</option>
      <option value="4">‚≠ê 4+</option>
      <option value="3">‚≠ê 3+</option>
    </select>
    <select [(ngModel)]="filtroPreco" (change)="filtrarEspacos()">
      <option value="">Pre√ßo por hora</option>
      <option value="asc">Menor para maior</option>
      <option value="desc">Maior para menor</option>
    </select>
  </div>

  <h2>Espa√ßos Dispon√≠veis</h2>

  <div class="cards">
    <div class="card" *ngFor="let espaco of espacosFiltrados">
      <img [src]="espaco.imagem || 'https://via.placeholder.com/300x200?text=Sem+Imagem'" alt="{{ espaco.nome }}">
      <div class="card-info">
        <h3>{{ espaco.nome }}</h3>
        <p>{{ espaco.descricao }}</p>
        <div class="avaliacao">‚≠ê {{ espaco.avaliacao || 0 }} / 5</div>
        <p class="preco">R$ {{ espaco.precoHora || 0 }} / hora</p>
        <button class="ver-mais" (click)="abrirDetalhes(espaco)">Ver mais</button>
        <button class="reservar" (click)="abrirReserva(espaco)">Reservar agora</button>
      </div>
    </div>
  </div>

  <!-- Modal de detalhes do espa√ßo -->
  <div class="modal" *ngIf="espacoSelecionado">
    <div class="modal-content">
      <span class="fechar" (click)="fecharModal()">&times;</span>

      <!-- Carrossel -->
      <div class="carousel">
        <img [src]="espacoSelecionado.imagens?.length
      ? espacoSelecionado.imagens[imagemIndex]
      : 'https://via.placeholder.com/600x400?text=Sem+Imagem'" alt="Imagem do espa√ßo" />

        <button *ngIf="espacoSelecionado.imagens?.length > 1" class="anterior" (click)="anteriorImagem()">
          &#10094;
        </button>
        <button *ngIf="espacoSelecionado.imagens?.length > 1" class="proxima" (click)="proximaImagem()">
          &#10095;
        </button>
      </div>

      <!-- Info principal -->
      <h2>{{ espacoSelecionado.nome }}</h2>
      <div class="avaliacao">‚≠ê {{ espacoSelecionado.avaliacao || 0 }} / 5</div>
      <p class="descricao">{{ espacoSelecionado.descricao }}</p>
      <p class="preco">üí∞ R$ {{ espacoSelecionado.precoHora || 0 }} / hora</p>

      <!-- Comodidades -->
      <h4>Comodidades</h4>
      <ul class="comodidades">
        <li *ngFor="let item of espacoSelecionado.comodidades">{{ item }}</li>
        <li *ngIf="!espacoSelecionado.comodidades?.length">Nenhuma comodidade cadastrada</li>
      </ul>

      <!-- Dono do espa√ßo -->
      <div class="dono-container" *ngIf="espacoSelecionado.dono; else semDono"
        (click)="abrirPerfil(espacoSelecionado.dono)">
        <img class="foto-dono" [src]="espacoSelecionado.dono.foto || 'https://via.placeholder.com/50'" alt="Dono">
        <div>
          <p><strong>{{ espacoSelecionado.dono.nome }}</strong></p>
          <p class="ver-perfil">Ver perfil</p>
        </div>
      </div>
      <ng-template #semDono>
        <p>Dono n√£o cadastrado</p>
      </ng-template>

      <!-- Opini√µes -->
      <h4>Opini√µes dos usu√°rios</h4>
      <div class="opinioes" *ngIf="espacoSelecionado.opinioes?.length; else semOpinioes">
        <div class="opiniao" *ngFor="let op of espacoSelecionado.opinioes">
          <img [src]="op.foto || 'https://via.placeholder.com/40'" alt="Usu√°rio">
          <div>
            <p><strong>{{ op.usuario }}</strong></p>
            <p>{{ op.texto }}</p>
          </div>
        </div>
      </div>
      <ng-template #semOpinioes>
        <p>Nenhuma opini√£o registrada.</p>
      </ng-template>
    </div>
  </div>

  <!-- Modal de reserva -->
  <app-reserva-modal 
    *ngIf="modalReservaAberto" 
    [espaco]="espacoParaReserva"
    [usuarioId]="usuarioId"
    (fechar)="fecharReserva()">
  </app-reserva-modal>
</div>
